services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: safasfly-api
    restart: unless-stopped
    ports:
      - "3002:3002"
    env_file:
      - ./.env
    environment:
      NODE_ENV: production
      PORT: 3002
      DB_PATH: ${DB_PATH:-/app/data/portfolio.db}
      ADMIN_SESSION_TTL_DAYS: ${ADMIN_SESSION_TTL_DAYS:-30}
      SEED_ADMIN_EMAIL: ${SEED_ADMIN_EMAIL:-lnieuwenhuis48@icloud.com}
      SEED_ADMIN_PASSWORD: ${SEED_ADMIN_PASSWORD:-change-me-strong-password}
      SMTP_PORT: ${SMTP_PORT:-587}
      SMTP_SECURE: ${SMTP_SECURE:-false}
      CORS_ORIGINS: ${CORS_ORIGINS:-http://localhost:5173,https://safasfly.dev,https://www.safasfly.dev}
    volumes:
      - backend_data:/app/data
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:3002/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3

volumes:
  backend_data:
